# 程序状态诊断和启动指南

## 当前状态

### ✅ 前端服务
- **状态**: 正常运行
- **端口**: 5173 (主服务), 5174 (备用)
- **进程**: 48497
- **地址**: http://localhost:5174/

### ⚠️ 后端服务
- **状态**: 需要启动
- **问题**: MySQL数据库未运行

### ❌ MySQL数据库
- **状态**: 未运行
- **错误**: connect ECONNREFUSED ::1:3306

## 问题根源

1. 有多个重复的进程在运行
2. MySQL数据库服务未启动
3. 后端服务因为无法连接数据库而启动失败

## 解决方案

### 步骤1: 启动MySQL服务

```bash
# 方式1: 使用brew services启动（推荐）
brew services start mysql

# 方式2: 手动启动MySQL
mysqld_safe &

# 方式3: 使用launchd（macOS）
sudo launchctl load -w /Library/LaunchDaemons/com.oracle.oss.mysql.mysqld.plist
```

### 步骤2: 验证MySQL是否运行

```bash
# 检查MySQL状态
mysqladmin ping

# 或者尝试连接
mysql -u root -p
```

### 步骤3: 创建数据库（如果需要）

```bash
mysql -u root -p << EOF
CREATE DATABASE IF NOT EXISTS stock_decision;
SHOW DATABASES;
EOF
```

### 步骤4: 启动后端服务

```bash
cd backend
npm run dev
```

预期输出：
```
info: MySQL数据库连接成功
info: 数据库表初始化完成
info: 数据库连接成功
info: Redis连接成功
info: WebSocket服务启动
info: 定时任务启动
info: 服务器运行在端口 3000
```

### 步骤5: 验证服务

访问以下地址验证：
- 前端: http://localhost:5174/
- 后端健康检查: http://localhost:3000/health
- 后端API: http://localhost:3000/api/auth/login

## 一键启动脚本

如果你已经安装了MySQL并且配置好了，可以直接运行：

```bash
./start.sh
```

## 常见问题排查

### 问题1: MySQL未安装

```bash
# 安装MySQL
brew install mysql

# 启动MySQL
brew services start mysql

# 设置root密码
mysql_secure_installation
```

### 问题2: MySQL端口被占用

```bash
# 查找占用3306端口的进程
lsof -i :3306

# 终止进程
kill -9 <PID>
```

### 问题3: 忘记MySQL密码

```bash
# 重置MySQL密码
mysql -u root
ALTER USER 'root'@'localhost' IDENTIFIED BY 'new_password';
FLUSH PRIVILEGES;
```

### 问题4: Redis未运行（可选）

Redis不是必需的，如果未安装可以跳过：

```bash
# 安装Redis
brew install redis

# 启动Redis
brew services start redis
```

或者修改代码使其在没有Redis时也能工作。

## 进程管理

### 查看所有相关进程

```bash
ps aux | grep -E "(node|npm|vite|tsx)" | grep -v grep
```

### 查看端口占用

```bash
lsof -i :3000 -i :3001 -i :5173 -i :5174
```

### 清理所有进程

```bash
# 清理后端进程
pkill -f "tsx watch src/index.ts"

# 清理前端进程
pkill -f "vite"

# 清理npm进程
pkill -f "npm run dev"
```

## 服务地址

- **前端应用**: http://localhost:5174/
- **后端API**: http://localhost:3000/api/
- **WebSocket**: ws://localhost:3000
- **健康检查**: http://localhost:3000/health

## 快速检查清单

- [ ] MySQL服务已启动
- [ ] 数据库 `stock_decision` 已创建
- [ ] 后端服务运行在端口3000
- [ ] 前端服务运行在端口5174
- [ ] 可以访问 http://localhost:5174/
- [ ] 可以访问 http://localhost:3000/health

## 下一步

1. 启动MySQL: `brew services start mysql`
2. 启动后端: `cd backend && npm run dev`
3. 访问前端: http://localhost:5174/
4. 测试登录功能

## 需要帮助？

如果问题仍未解决，请提供：
1. MySQL的错误日志
2. 后端服务的完整启动日志
3. 浏览器控制台的错误信息

