# ğŸ” é—ªé€€åŸå› åˆ†æå’ŒæŠ€æœ¯æ–¹æ¡ˆ

## ğŸ› é—ªé€€çš„æ ¹æœ¬åŸå› 

### é—®é¢˜1: ReduxçŠ¶æ€ä¸ä¸€è‡´
```typescript
// å½“å‰çŠ¶æ€
{
  isAuthenticated: true,  // â† ä»localStorageè¯»åˆ°äº†token
  user: null,              // â† ä½†ç”¨æˆ·ä¿¡æ¯ä¸å­˜åœ¨
  token: "eyJhbGc..."      // â† æ—§tokenå­˜åœ¨
}
```

**è§¦å‘å´©æºƒ**:
```typescript
// AppLayout.tsx
<span>æ¬¢è¿ï¼Œ{user.username}</span>  // â† useræ˜¯nullï¼Œè®¿é—®null.usernameå´©æºƒ
```

### é—®é¢˜2: ç¼ºå°‘çŠ¶æ€åŒæ­¥æœºåˆ¶
- localStorage æœ‰ token
- Redux æœ‰ isAuthenticated
- ä½† user å¯¹è±¡æ²¡æœ‰ä» token æ¢å¤

### é—®é¢˜3: æ²¡æœ‰é”™è¯¯è¾¹ç•Œ
- ç»„ä»¶å´©æºƒåæ²¡æœ‰ fallback
- å¯¼è‡´æ•´ä¸ªåº”ç”¨ç™½å±

---

## ğŸ’¡ æ›´å¥½çš„æŠ€æœ¯è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: æ·»åŠ  Error Boundary (æ¨è)

ä½¿ç”¨ React Error Boundary æ•è·é”™è¯¯ï¼š

```typescript
// components/ErrorBoundary.tsx
import React from 'react'

class ErrorBoundary extends React.Component {
  state = { hasError: false, error: null }

  static getDerivedStateFromError(error) {
    return { hasError: true, error }
  }

  componentDidCatch(error, errorInfo) {
    console.error('Error caught:', error, errorInfo)
  }

  render() {
    if (this.state.hasError) {
      return (
        <div style={{ padding: '50px', textAlign: 'center' }}>
          <h2>é¡µé¢åŠ è½½å¤±è´¥</h2>
          <p>è¯·åˆ·æ–°é¡µé¢é‡è¯•</p>
          <button onClick={() => window.location.reload()}>
            åˆ·æ–°é¡µé¢
          </button>
        </div>
      )
    }
    return this.props.children
  }
}
```

### æ–¹æ¡ˆ2: ç”¨æˆ·ä¿¡æ¯æŒä¹…åŒ–

å°†ç”¨æˆ·ä¿¡æ¯ä¹Ÿå­˜åˆ° localStorageï¼š

```typescript
// authSlice.ts
export const login = createAsyncThunk(
  'auth/login',
  async (credentials) => {
    const response = await authAPI.login(credentials)
    const userData = response.data
    
    // æŒä¹…åŒ–ç”¨æˆ·ä¿¡æ¯
    localStorage.setItem('token', userData.token)
    localStorage.setItem('user', JSON.stringify(userData.user))
    
    return userData
  }
)

// åˆå§‹åŒ–æ—¶æ¢å¤
const initialState: AuthState = {
  user: JSON.parse(localStorage.getItem('user') || 'null'),
  token: localStorage.getItem('token'),
  isAuthenticated: !!localStorage.getItem('token'),
  loading: false,
  error: null,
}
```

### æ–¹æ¡ˆ3: æ·»åŠ è®¤è¯æ¢å¤é€»è¾‘

åœ¨ App å¯åŠ¨æ—¶éªŒè¯ tokenï¼š

```typescript
// App.tsx
useEffect(() => {
  const token = localStorage.getItem('token')
  if (token && !user) {
    // éªŒè¯tokenå¹¶æ¢å¤ç”¨æˆ·ä¿¡æ¯
    authAPI.getProfile()
      .then(response => {
        dispatch(setUser(response.data))
      })
      .catch(() => {
        // tokenæ— æ•ˆï¼Œæ¸…é™¤
        localStorage.removeItem('token')
        dispatch(logout())
      })
  }
}, [])
```

### æ–¹æ¡ˆ4: ç»Ÿä¸€çŠ¶æ€ç®¡ç†

åˆ›å»ºè®¤è¯ Hookï¼š

```typescript
// hooks/useAuth.ts
export const useAuth = () => {
  const dispatch = useAppDispatch()
  const { user, isAuthenticated, token } = useAppSelector(state => state.auth)

  useEffect(() => {
    if (token && !user) {
      // æ¢å¤ç”¨æˆ·ä¿¡æ¯
      dispatch(fetchUserProfile())
    }
  }, [token, user, dispatch])

  return { user, isAuthenticated, token }
}
```

---

## ğŸ¯ æ¨èçš„æœ€ä½³æ–¹æ¡ˆ

### ç»¼åˆæ–¹æ¡ˆï¼šå¤šé‡ä¿æŠ¤

1. **Error Boundary**: æ•è·æ¸²æŸ“é”™è¯¯
2. **çŠ¶æ€æŒä¹…åŒ–**: localStorage ä¿å­˜ç”¨æˆ·ä¿¡æ¯
3. **åŠ è½½çŠ¶æ€**: æ˜¾ç¤ºåŠ è½½ä¸­
4. **å®‰å…¨æ£€æŸ¥**: å§‹ç»ˆæ£€æŸ¥ null/undefined

---

## ğŸ“Š å¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | ä¼˜å…ˆçº§ |
|------|------|------|--------|
| Error Boundary | æ•è·æ‰€æœ‰é”™è¯¯ | éœ€è¦é¢å¤–ç»„ä»¶ | â­â­â­â­â­ |
| ç”¨æˆ·ä¿¡æ¯æŒä¹…åŒ– | ç®€å•ç›´æ¥ | æ•°æ®åŒæ­¥ | â­â­â­â­ |
| è®¤è¯æ¢å¤é€»è¾‘ | è‡ªåŠ¨æ¢å¤ | ä»£ç å¤æ‚ | â­â­â­ |
| è®¤è¯ Hook | å¯å¤ç”¨ | éœ€è¦æ”¹é€  | â­â­â­ |

---

## âœ… å®æ–½å»ºè®®

**ç«‹å³å®æ–½**:
1. Error Boundary âœ…
2. ç”¨æˆ·ä¿¡æ¯æŒä¹…åŒ– âœ…
3. é»˜è®¤å€¼æ£€æŸ¥ âœ…

**åç»­ä¼˜åŒ–**:
4. è®¤è¯æ¢å¤é€»è¾‘
5. è®¤è¯ Hook
6. æ›´å¥½çš„é”™è¯¯å¤„ç†

---

**æ¥ä¸‹æ¥æˆ‘å°†å®æ–½è¿™äº›æ–¹æ¡ˆï¼** ğŸš€

